services:
  mongo_test_server:
    image: mongo:7.0
    container_name: mongo_test_server
    command: ["--replSet", "TestReplicaSet", "--bind_ip_all", "--port", "27017"]
    ports: #[]         # only accessible from containers in net
      - 27017:27017    # for testing locally
    volumes: []
      #- datapath:/data/db
    # healthcheck:
    #   test: ["CMD-SHELL", "mongosh --authenticationDatabase admin --quiet --eval \"try { printjson(rs.status()) } catch (err) { print('Initializing TestReplicaSet}'); rs.initiate({_id:'TestReplicaSet', members:[{_id:0, host:'localhost:27017'}]}); \" >> /tmp/rs_health.log 2>&1"]
    #   interval: 10m # Good interval to not inconvenience the system
    #   timeout: 5s
    #   retries: 1
    #   start_period: 5s # Good enough to ensure we don't wait interval at start.
    networks:
      - TEST_NET
  
  postgres_test_data_warehouse:
    image: postgres:16
    container_name: postgres_test_data_warehouse
    environment:
      POSTGRES_USER: airflow
      POSTGRES_PASSWORD: airflow
      POSTGRES_DB: airflow
      PGUSER: airflow
      PGPASSWORD: airflow
      PGDATABASE: airflow
    ports:
      - 8080:5432
    restart: always
    networks:
      - TEST_NET


networks:
  TEST_NET:
    name: TEST_NET
    driver: bridge
  
  
