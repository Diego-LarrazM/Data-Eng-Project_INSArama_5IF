services:
  $MONGO_HOST_NAME:
    image: mongo:7.0
    container_name: $MONGO_HOST_NAME
    command: ["--replSet", "TestReplicaSet", "--bind_ip_all", "--port", "27017"]
    ports: #[]         # only accessible from containers in net
      - $MONGO_PORT:27017    # for testing locally
    volumes: []
      #- datapath:/data/db
    # healthcheck:
    #   test: ["CMD-SHELL", "mongosh --authenticationDatabase admin --quiet --eval \"try { printjson(rs.status()) } catch (err) { print('Initializing $MONGO_RSET_NAME}'); rs.initiate({_id:'$MONGO_RSET_NAME', members:[{_id:0, host:'localhost:27017'}]}); \" >> /tmp/rs_health.log 2>&1"]
    #   interval: 10m # Good interval to not inconvenience the system
    #   timeout: 5s
    #   retries: 1
    #   start_period: 5s # Good enough to ensure we don't wait interval at start.
    networks:
      - $INSARAMA_NET
  
  $POSTGRES_HOST:
    image: postgres:16
    container_name: $POSTGRES_HOST
    environment:
      POSTGRES_USER: $POSTGRES_USER
      POSTGRES_PASSWORD: $POSTGRES_PASSWORD
      POSTGRES_DB: $POSTGRES_DB
      PGUSER: $POSTGRES_USER
      PGPASSWORD: $POSTGRES_PASSWORD
      PGDATABASE: $POSTGRES_DB
    ports:
      - $POSTGRES_PORT:5432
    restart: always
    networks:
      - $INSARAMA_NET


networks:
  $INSARAMA_NET:
    name: $INSARAMA_NET
    driver: bridge
  
  
